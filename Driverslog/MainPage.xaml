<phone:PhoneApplicationPage 
    x:Class="Driverslog.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone" 
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:cal="clr-namespace:Caliburn.Micro;assembly=Caliburn.Micro" 
    xmlns:helpers="clr-namespace:Driverslog.Helpers" 
    xmlns:scm="clr-namespace:System.ComponentModel;assembly=System.Windows" 
    xmlns:model="clr-namespace:Driverslog.Models" mc:Ignorable="d" d:DesignWidth="480" d:DesignHeight="696"
    d:DataContext="{d:DesignData /SampleData/MainViewModelSampleData.xaml}"
    SupportedOrientations="Portrait" Orientation="Portrait"
    shell:SystemTray.IsVisible="True"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="{StaticResource PhoneForegroundBrush}"
    >
    <phone:PhoneApplicationPage.Resources>
        <helpers:TypeToVisibilityConverter x:Key="TypeToVisibilityConverter"/>
    </phone:PhoneApplicationPage.Resources>
    <Grid x:Name="LayoutRoot">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel x:Name="TitlePanel" Grid.Row="0" Margin="12,17,0,28">
            <TextBlock x:Name="ApplicationTitle" Text="Driver's log" Style="{StaticResource PhoneTextNormalStyle}"/>
            <TextBlock x:Name="PageTitle" Text="My log" Margin="9,-7,0,0" Style="{StaticResource PhoneTextTitle1Style}"/>
        </StackPanel>

        <Grid x:Name="ContentGrid" Grid.Row="1" Margin="12,0,12,0">
            <Grid.Resources>
                <model:TripAndExpenseCollection x:Key="TripAndExpenses"/>
                <CollectionViewSource x:Key="ViewSource" Source="{Binding Source={StaticResource TripAndExpenses}, Path=Current}">
                    <CollectionViewSource.SortDescriptions>
                        <scm:SortDescription PropertyName="Date" Direction="Descending"/>
                    </CollectionViewSource.SortDescriptions>
                </CollectionViewSource>
            </Grid.Resources>
            <!--ItemsSource="{Binding Source={StaticResource ViewSource}}"-->
            <ListBox x:Name="thelistbox" 
                     ItemsSource="{Binding Source={StaticResource ViewSource}}"         
                     SelectedItem="{Binding SelectedItem, Mode=TwoWay}" 
                     SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}"
                     cal:Message.Attach="[Event SelectionChanged] = [Action EditItem]">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <!-- TRIP -->
                            <Border Visibility="{Binding Converter={StaticResource TypeToVisibilityConverter}, ConverterParameter=Trip}" Height="54" Width="54" BorderBrush="{StaticResource PhoneAccentBrush}" BorderThickness="2.5" Margin="10,12,0,0" VerticalAlignment="Top" CornerRadius="4">
                                <Path Width="40.7195" Height="33.1042" Stretch="Fill" StrokeLineJoin="Round" Stroke="{StaticResource PhoneAccentBrush}" Fill="{StaticResource PhoneAccentBrush}" Data="M 10.6144,21.647C 11.8629,19.1235 14.4838,13.286 16.1768,12.2968C 18.6875,10.8299 22.4257,10.6971 26.7351,10.687L 26.7202,10.6667C 31.3431,10.6667 35.3696,10.7263 38.024,12.2772C 39.717,13.2664 42.338,19.104 43.5864,21.6275C 49.7104,25.5585 45.6565,34.3867 45.5036,36.3472L 45.5147,36.3472L 45.5147,39.3464L 45.5259,39.6131L 45.5147,39.8797L 45.5147,39.9262L 45.5104,39.9262C 45.3533,41.5088 44.0181,42.7447 42.3942,42.7447C 40.7703,42.7447 39.4351,41.5088 39.278,39.9262L 39.2737,39.9262L 39.2737,39.8796L 39.2625,39.6131L 39.2737,39.3466L 39.2737,36.3484L 45.4834,36.3472L 39.2737,36.3472L 39.2737,36.3484L 26.9372,36.3509L 8.71266,36.3733L 14.9288,36.3733L 14.9288,39.3725L 14.94,39.6392L 14.9288,39.9058L 14.9288,39.9523L 14.9245,39.9523C 14.7674,41.5349 13.4322,42.7708 11.8083,42.7708C 10.1845,42.7708 8.84925,41.5349 8.69213,39.9523L 8.68785,39.9523L 8.68785,39.9057L 8.67667,39.6392L 8.68785,39.3727L 8.68785,36.3733L 8.69776,36.3733C 8.55336,34.426 4.48363,25.5825 10.6144,21.647 Z M 13.5457,22.0646L 40.806,22.0646C 39.7522,20.0166 38.9568,17.8294 37.6445,15.9206C 37.1077,15.682 32.9918,14.3697 27.146,14.3697C 21.3002,14.3697 16.7668,15.861 16.7668,15.861L 13.5457,22.0646 Z M 12.7702,25.1068C 10.7935,25.1068 9.19115,26.7092 9.19115,28.6859C 9.19115,30.6625 10.7935,32.2649 12.7702,32.2649C 14.7468,32.2649 16.3492,30.6625 16.3492,28.6859C 16.3492,26.7092 14.7468,25.1068 12.7702,25.1068 Z M 41.5815,25.0173C 39.6048,25.0173 38.0024,26.6197 38.0024,28.5964C 38.0024,30.573 39.6048,32.1754 41.5815,32.1754C 43.5581,32.1754 45.1605,30.573 45.1605,28.5964C 45.1605,26.6197 43.5581,25.0173 41.5815,25.0173 Z M 27.1853,29.4352C 23.188,29.4352 19.688,29.9773 17.7581,30.7885L 17.7473,30.7885L 17.7473,30.7931L 17.7141,30.8072L 17.7473,30.8072L 17.7473,33.9351L 36.6342,33.9351L 36.6342,30.8072L 36.6566,30.8072L 36.6342,30.7976L 36.6342,30.7885L 36.6126,30.7885C 34.6827,29.9773 31.1827,29.4352 27.1853,29.4352 Z " Margin="4.14,8,4.14,7.895" UseLayoutRounding="False"/>
                            </Border>
                            <StackPanel Visibility="{Binding Converter={StaticResource TypeToVisibilityConverter}, ConverterParameter=Trip}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock x:Name="From" Text="{Binding From}" Style="{StaticResource PhoneTextTitle2Style}"/>
                                    <Border Width="16">
                                        <Path Height="16" Width="11" Fill="{StaticResource PhoneAccentBrush}" Stretch="Fill" Margin="0,6,0,0" HorizontalAlignment="Center" UseLayoutRounding="False" Data="M337.59924,129.61948 L337.59924,141.51501 L345.5704,135.87381 z" VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock x:Name="To" Text="{Binding To}" Style="{StaticResource PhoneTextTitle2Style}"/>
                                </StackPanel>
                                <TextBlock x:Name="Distance" Text="{Binding Distance}" Style="{StaticResource PhoneTextNormalStyle}"/>
                            </StackPanel>
                            <!-- EXPENSE -->
                            <Border Visibility="{Binding Converter={StaticResource TypeToVisibilityConverter}, ConverterParameter=Expense}" Height="54" Width="54" BorderBrush="{StaticResource PhoneAccentBrush}" BorderThickness="2.5" Margin="10,12,0,0" VerticalAlignment="Top" CornerRadius="4">
                                <Canvas x:Name="expense_icon" Width="54" Height="54" Canvas.Left="0" Canvas.Top="0" Margin="-3,-3,-2,-2">
                                    <Path Width="44.7051" Height="31.0871" Canvas.Left="4.63706" Canvas.Top="11.5938" Stretch="Fill" StrokeLineJoin="Round" Stroke="{StaticResource PhoneAccentBrush}" Data="M 5.13706,24.6145L 43.0392,12.0938L 48.8421,29.6601L 10.94,42.1808L 5.13706,24.6145 Z " Fill="{StaticResource PhoneBackgroundBrush}"/>
                                    <Path Width="43.305" Height="25.4733" Canvas.Left="5.71208" Canvas.Top="14.6592" Stretch="Fill" StrokeLineJoin="Round" Stroke="{StaticResource PhoneAccentBrush}" Fill="{StaticResource PhoneBackgroundBrush}" Data="M 6.21208,21.3568L 45.6447,15.1592L 48.5171,33.4348L 9.08449,39.6325L 6.21208,21.3568 Z "/>
                                    <Rectangle Width="40.9167" Height="19.5" Canvas.Left="6.75" Canvas.Top="17.3333" Stretch="Fill" StrokeLineJoin="Round" Stroke="{StaticResource PhoneAccentBrush}" Fill="{StaticResource PhoneBackgroundBrush}"/>
                                    <Path Width="6.29167" Height="6.29167" Canvas.Left="8.92708" Canvas.Top="19.5104" Stretch="Fill" Fill="{StaticResource PhoneAccentBrush}" Data="M 8.92708,19.5104L 15.2187,19.5104L 15.2187,20.5104L 9.88542,20.5104L 9.88542,25.8021L 8.92708,25.8021L 8.92708,19.5104 Z "/>
                                    <Path Width="6.29166" Height="6.29166" Canvas.Left="39.2292" Canvas.Top="19.5104" Stretch="Fill" Fill="{StaticResource PhoneAccentBrush}" Data="M 45.5208,19.5104L 45.5208,25.8021L 44.5208,25.8021L 44.5208,20.4687L 39.2292,20.4687L 39.2292,19.5104L 45.5208,19.5104 Z "/>
                                    <Path Width="6.29167" Height="6.29167" Canvas.Left="8.90625" Canvas.Top="28.5" Stretch="Fill" Fill="{StaticResource PhoneAccentBrush}" Data="M 8.90625,34.7917L 8.90625,28.5L 9.90625,28.5L 9.90625,33.8333L 15.1979,33.8333L 15.1979,34.7917L 8.90625,34.7917 Z "/>
                                    <Path Width="6.29166" Height="6.29167" Canvas.Left="39.2083" Canvas.Top="28.4792" Stretch="Fill" Fill="{StaticResource PhoneAccentBrush}" Data="M 45.5,34.7708L 39.2083,34.7708L 39.2083,33.7708L 44.5417,33.7708L 44.5417,28.4792L 45.5,28.4792L 45.5,34.7708 Z "/>
                                    <Path Stretch="Fill" Fill="{StaticResource PhoneAccentBrush}" Data="M 68.2396,25.3958C 71.5188,25.3958 74.1771,28.0541 74.1771,31.3333C 74.1771,34.6125 71.5188,37.2708 68.2396,37.2708C 64.9604,37.2708 62.3021,34.6125 62.3021,31.3333C 62.3021,28.0541 64.9604,25.3958 68.2396,25.3958 Z M 64.4577,29.9361C 63.0394,30.8465 63.9809,32.8924 64.0143,33.3429L 64.012,33.3429L 64.012,34.0368L 64.0094,34.0984L 64.012,34.1601L 64.012,34.1709L 64.013,34.1709C 64.0493,34.537 64.3582,34.8229 64.7339,34.8229C 65.1096,34.8229 65.4184,34.537 65.4548,34.1709L 65.4558,34.1709L 65.4558,34.1601L 65.4584,34.0984L 65.4558,34.0368L 65.4558,33.3429L 64.0177,33.3429L 68.2339,33.3377L 71.0878,33.3369L 72.5244,33.3369L 71.0878,33.3371L 71.0878,34.0307L 71.0852,34.0924L 71.0878,34.1541L 71.0878,34.1648L 71.0888,34.1648C 71.1252,34.531 71.4341,34.8169 71.8097,34.8169C 72.1854,34.8169 72.4943,34.531 72.5306,34.1648L 72.5316,34.1648L 72.5316,34.1541L 72.5342,34.0924L 72.5316,34.0307L 72.5316,33.3369L 72.5291,33.3369C 72.5644,32.8833 73.5023,30.841 72.0855,29.9315C 71.7967,29.3477 71.1904,27.9973 70.7987,27.7684C 70.1846,27.4096 69.2531,27.3958 68.1837,27.3958L 68.1871,27.4005C 67.1901,27.4029 66.3253,27.4336 65.7445,27.773C 65.3528,28.0018 64.7465,29.3523 64.4577,29.9361 Z M 65.1358,30.0327L 65.881,28.5975C 65.881,28.5975 66.9298,28.2525 68.2822,28.2525C 69.6345,28.2525 70.5867,28.5561 70.7109,28.6113C 71.0145,29.0529 71.1985,29.5589 71.4423,30.0327L 65.1358,30.0327 Z M 64.9564,30.7365C 65.4137,30.7365 65.7844,31.1072 65.7844,31.5645C 65.7844,32.0217 65.4137,32.3924 64.9564,32.3924C 64.4991,32.3924 64.1284,32.0217 64.1284,31.5645C 64.1284,31.1072 64.4991,30.7365 64.9564,30.7365 Z M 71.6217,30.7158C 72.079,30.7158 72.4497,31.0865 72.4497,31.5438C 72.4497,32.001 72.079,32.3717 71.6217,32.3717C 71.1644,32.3717 70.7937,32.001 70.7937,31.5438C 70.7937,31.0865 71.1644,30.7158 71.6217,30.7158 Z M 68.2913,31.7378C 69.216,31.7378 70.0257,31.8632 70.4722,32.0509L 70.4772,32.0509L 70.4772,32.053L 70.4824,32.0552L 70.4772,32.0552L 70.4772,32.7788L 66.1078,32.7788L 66.1078,32.0552L 66.1002,32.0552L 66.1078,32.0519L 66.1078,32.0509L 66.1103,32.0509C 66.5568,31.8632 67.3665,31.7378 68.2913,31.7378 Z " Height="11.875" Canvas.Left="21.677" Canvas.Top="21.406" UseLayoutRounding="False" Width="11.875"/>
                                </Canvas>
                            </Border>
                            <StackPanel Visibility="{Binding Converter={StaticResource TypeToVisibilityConverter}, ConverterParameter=Expense}">
                                <TextBlock x:Name="Title" Text="{Binding Title}" Style="{StaticResource PhoneTextTitle2Style}"/>
                                <TextBlock x:Name="Amount" Text="{Binding AmountWithCurrency}" Style="{StaticResource PhoneTextNormalStyle}"/>
                            </StackPanel>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </Grid>
    <phone:PhoneApplicationPage.ApplicationBar>
        <shell:ApplicationBar IsVisible="True" IsMenuEnabled="True">
            <cal:AppBarButton Text="trip" IconUri="/icons/appbar.new.rest.png" Message="CreateNewTrip"/>
            <cal:AppBarButton Text="expense" IconUri="/icons/appbar.favs.rest.png" Message="CreateNewExpense"/>
            <shell:ApplicationBar.MenuItems>
                <cal:AppBarMenuItem Text="Export" Message="ExportTrips"/>
                <cal:AppBarMenuItem Text="Clear" Message="Clear"/>
                <cal:AppBarMenuItem Text="Settings" Message="Settings"/>
            </shell:ApplicationBar.MenuItems>
        </shell:ApplicationBar>
    </phone:PhoneApplicationPage.ApplicationBar>
</phone:PhoneApplicationPage>